!function(){"use strict";angular.module("app",["ngRoute","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider",function(e){e.html5Mode(!0),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope",function(e){function n(n){var o=e.currentStep||0;e.currentStep=n;var t=E.circles[n]||u(n);t.add(),E.circles[n]=t,o!==n&&(t=E.circles[o],t.remove())}function o(){v++,v=Math.min(g.length-1,v),n(v)}function t(){v--,v=Math.max(0,v),n(v)}function r(e){var n=new THREE.Color(O.colors.background).getHexString();console.log("backgroundColor",n),document.body.style.backgroundColor="#"+n,E.ribbon&&E.ribbon.setMaterial(),angular.forEach(E.circles,function(e){e&&e.material.color.setHex(O.colors.lines)}),E.lines&&(E.lines.material.color.setHex(O.colors.lines),"1"===O.display?E.lines.add():E.lines.remove()),E.dots&&(E.dots.material.color.setHex(O.colors.lines),"2"===O.display?E.dots.add():E.dots.remove())}function a(e,n,o){var t=O.rows,r=O.audioStrength,a=O.noiseStrength,i=Math.floor(n/t),l=n-i*t,c=2*Math.abs(l-t/2),s=1-Math.abs(i-t/2)/(t/2),u=1-Math.abs(l-t/2)/(t/2),d=(s+u)/2,f=c%O.bands,p=b[f],h=p/O.bands*s*2,m=i*t+(l+o)%t,E=O.noiseMap[m]/64*a*d+r*h;e.z+=(E-e.z)/(3+3*Math.max(1e-6,1-d))}function i(e,n,o){var t=2*Math.random()-1,r=Math.abs(t);return(o?Math.floor(t/r):1)*(e+(n-e)*r)}function l(){function e(){console.log("OBJECTS.ribbon.add"),H.add(h)}function n(){console.log("OBJECTS.ribbon.remove"),H.remove(h)}function o(){var e=1/g.length/10,n=v/g.length,o=(n+e).mod(1);b+=(n-b)/8,w+=(o-w)/8;var t=u.getPointAt(b),r=d.getPointAt(w);R.position.copy(t),R.target.copy(r),R.lookAt(R.target),m++}function t(){var e=new THREE.Vector2(window.innerWidth,window.innerHeight);return new MeshLineMaterial({color:new THREE.Color(O.colors.lines),lineWidth:4,opacity:1,resolution:e,sizeAttenuation:1,near:1,far:1e3,depthTest:!1,blending:THREE.AdditiveBlending,transparent:!1,side:THREE.DoubleSide})}function r(){E.ribbon.material=t(),E.ribbon.object.material=E.ribbon.material}var a=t(),l=new THREE.Vector3,c=new Array(12).fill(null).map(function(){var e=(new THREE.Vector3).copy(l);return l.x+=i(500,1e3,!0),l.y+=i(50,100,!0),l.z+=i(1e3,2e3,!1),e}),s=new THREE.CatmullRomCurve3(c);s.type="catmullrom";var u=new THREE.CatmullRomCurve3(s.points.map(function(e){return new THREE.Vector3(e.x,e.y+30,e.z)}));u.type="catmullrom";var d=new THREE.CatmullRomCurve3(s.points.map(function(e){return new THREE.Vector3(e.x,e.y+15,e.z)}));d.type="catmullrom";var f=new THREE.Geometry;f.vertices=s.getPoints(1200);var p=new MeshLine;p.setGeometry(f);var h=new THREE.Mesh(p.geometry,a);H.add(h);var m=0;R.target=R.target||new THREE.Vector3(0,0,0);var w=0,b=0;return{object:h,spline:s,cameraSpline:u,targetSpline:d,geometry:f,material:a,add:e,remove:n,update:o,setMaterial:r}}function c(){function e(){console.log("OBJECTS.dots.add"),H.add(i)}function n(){console.log("OBJECTS.dots.remove"),H.remove(i)}function o(){angular.forEach(r.vertices,function(e,n){a(e,n,h)}),h++,r.verticesNeedUpdate=!0}for(var t=new THREE.PointsMaterial({color:O.colors.lines,size:1,sizeAttenuation:!1}),r=new THREE.Geometry,i=new THREE.Points(r,t),l=O.rows,c=O.space,s=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l;return Math.abs(o-l/2),Math.abs(t-l/2),{x:-c*l/2+c*t,y:-c*l/2+c*o,z:0}}),u=0,d=s.length;u<d;){var f=s[u],p=new THREE.Vector3;p.x=f.x,p.y=f.y,p.z=f.z,r.vertices.push(p),u++}r.verticesNeedUpdate=!0,i.geometry=r;var h=0;return{object:i,material:t,add:e,remove:n,update:o}}function s(){function e(){console.log("OBJECTS.lines.add"),H.add(t)}function n(){console.log("OBJECTS.lines.remove"),H.remove(t)}function o(){O.rows,O.audioStrength,O.noiseStrength,angular.forEach(d,function(e,n){a(e,n,f)}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),f++}var t,r,i=[];r=new THREE.LineBasicMaterial({color:O.colors.lines}),t=new THREE.Object3D;for(var l=O.rows,c=O.space;i.length<O.rows;){var s=new THREE.Geometry,u=new THREE.Line(s,r);u.points=new Array(l).fill(null),i.push(u),t.add(u)}var d=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l,r=(Math.abs(o-l/2),Math.abs(t-l/2),new THREE.Vector3(-c*l/2+c*t,-c*l/2+c*o,0));return i[t].points[o]=r,i[t].geometry.vertices.push(r),r}),f=0;return{add:e,remove:n,update:o,object:t,material:r}}function u(e){function n(){console.log("OBJECTS.circles.add"),H.add(r),f=Date.now(),p=!1,d.enabled=!0,setTimeout(function(){f=!1},3e3)}function o(){console.log("OBJECTS.circles.remove"),f=!1,p=Date.now(),setTimeout(function(){H.remove(r),p=!1,d.enabled=!1},3e3)}function t(){var e=O.rows,n=O.audioStrength,o=O.noiseStrength,t=O.circularStrength;angular.forEach(u,function(r,a){var i=Math.floor(a/e),l=a-i*e,c=(Math.abs(l-e/2),Math.abs(i-e/2),Math.abs(l-e/2),i%O.bands),s=(b[c]+b[e-1-c])/2,u=s/O.bands,d=l*e+(i+h)%e,f=O.noiseMap[d],p=1-(e-l)/e*t,m=r.r.z+f/64*o*p+2*n*u*u*p,E=r.radius||m;E+=(m-E)/2,r.x=r.r.x*E,r.y=r.r.y*E,r.z=0,r.radius=E}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),r.lookAt(R.position),h++}var r,a,i=[];a=new THREE.LineBasicMaterial({color:O.colors.lines}),r=new THREE.Object3D;var l=O.rows;for(O.space;i.length<O.rows;){var c=new THREE.Geometry,s=new THREE.LineLoop(c,a);s.points=new Array(l).fill(null),i.push(s),r.add(s)}var u=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l,r=2*Math.PI/l,a=r*o+r*t*.1,c=new THREE.Vector3;return c.r={x:Math.cos(a),y:Math.sin(a),z:96+t*t*t*1e-4},i[t].points[o]=c,i[t].geometry.vertices.push(c),c}),d={enabled:!1},f=!1,p=!1,h=0,m=E.ribbon.cameraSpline.getPointAt((e+.5)/g.length);return r.position.copy(m),r.scale.x=r.scale.y=r.scale.z=.3,{add:n,remove:o,update:t,object:r,material:a,state:d}}function d(){b&&(w.getByteFrequencyData(b),"0"===O.display?angular.forEach(E.circles,function(e){e&&e.state.enabled&&e.update()}):"1"===O.display?E.lines.update():"2"===O.display&&E.dots.update())}function f(){M.begin(),p(),M.end(),requestAnimationFrame(f)}function p(){D&&D.update(),E.tube&&E.tube.update(),E.ribbon&&E.ribbon.update(),d(),z.render(H,R)}function h(){function e(){B=window.innerWidth,L=window.innerHeight,P=B/2,V=L/2,z.setSize(B,L),R.aspect=B/L,R.updateProjectionMatrix()}window.addEventListener("resize",e,!1)}function m(){function e(e){return e*e*e*(e*(6*e-15)+10)}function n(e,n,o){return n+e*(o-n)}function o(e,n,o,t){var r=15&e,a=r<8?n:o,i=r<4?o:12==r||14==r?n:t;return(0==(1&r)?a:-a)+(0==(2&r)?i:-i)}for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)t[256+r]=t[r];return{noise:function(r,a,i){var l=Math.floor(r),c=Math.floor(a),s=Math.floor(i),u=255&l,d=255&c,f=255&s;r-=l,a-=c,i-=s;var p=r-1,h=a-1,m=i-1,E=e(r),g=e(a),v=e(i),w=t[u]+d,b=t[w]+f,y=t[w+1]+f,M=t[u+1]+d,T=t[M]+f,H=t[M+1]+f;return n(v,n(g,n(E,o(t[b],r,a,i),o(t[T],p,a,i)),n(E,o(t[y],r,h,i),o(t[H],p,h,i))),n(g,n(E,o(t[b+1],r,a,m),o(t[T+1],p,a,i-1)),n(E,o(t[y+1],r,h,m),o(t[H+1],p,h,m))))}}}var E={};Number.prototype.mod=function(e){return(this%e+e)%e};var g=new Array(24).fill().map(function(e,n){return n+1}),v=0;e.nextStep=o,e.previousStep=t,e.currentStep=v;var w,b,y,M,T,H,R,S,C,A,x,z,_,B,L,P,V,D=null,O={audioUrl:"audio/rossini-192.mp3",colors:{background:1118481,lines:10066329,notes:4473924},bands:256,rows:128,space:10,audioStrength:60,noiseStrength:25,circularStrength:.9,display:"0",randomize:function(){for(var e=0;e<T.__controllers.length;e++){var n=T.__controllers[e];if(n.__min){var o=n.__min+(n.__max-n.__min)*Math.random();this[n.property]=o,n.updateDisplay()}n.__color&&(n.__color.r=Math.floor(255*Math.random()),n.__color.g=Math.floor(255*Math.random()),n.__color.b=Math.floor(255*Math.random()),n.updateDisplay(),n.setValue(n.__color.hex))}}};O.points=new Array(2*O.bands).fill(null).map(function(){var e=1e3;return new THREE.Vector3(-e+2e3*Math.random(),-e+2e3*Math.random(),-e+2e3*Math.random())}),O.noiseMap=function(e,n){for(var o=e*n,t=new Uint8Array(o),r=new m,a=1,i=100*Math.random(),l=0;l<4;l++){for(var c=0;c<o;c++){var s=c%e,u=~~(c/e);t[c]+=Math.abs(r.noise(s/a,u/a,i)*a*1.75)}a*=5}return t}(O.rows,O.rows),function(){B=window.innerWidth,L=window.innerHeight,C=B/L,P=B/2,V=L/2,S=60,A=.001,x=2e4,H=new THREE.Scene,R=new THREE.PerspectiveCamera(S,C,A,x),R.position.z=100,R.position.y=-500,R.lookAt(new THREE.Vector3(0,0,0)),z=new THREE.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0}),z.setClearColor(0,0),z.setSize(B,L),z.shadowMap.enabled=!0,_=document.getElementById("scene"),_.appendChild(z.domElement),M=new Stats,_.appendChild(M.dom),h()}(),function(){E.ribbon=l(),E.dots=c(),E.lines=s(),E.circles=new Array(g).fill(null)}(),function(){var e,n,o=window.AudioContext||window.webkitAudioContext;e=null,n=new o,w=n.createAnalyser(),y=new Audio,y.src=O.audioUrl,y.controls=!0,y.addEventListener("canplay",function(){var o;return console.log("audio canplay"),e=n.createMediaElementSource(y),e.connect(w),e.connect(n.destination),w.fftSize=2*O.bands,o=w.frequencyBinCount,console.log("bufferLength",o),b=new Uint8Array(o)}),y.volume=.01,y.play()}(),function(){T=new dat.GUI,T.closed=!0,T.add(O,"display",{Circles:0,Lines:1,Dots:2}).onChange(r),T.addColor(O.colors,"background").onChange(r),T.addColor(O.colors,"lines").onChange(r),T.add(O,"audioStrength",10,100).onChange(r),T.add(O,"noiseStrength",10,100).onChange(r),T.add(O,"circularStrength",.01,.9).onChange(r),T.add(O,"randomize")}(),r(),f()}])}();
//# sourceMappingURL=app.min.js.map
