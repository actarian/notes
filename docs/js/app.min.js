!function(){"use strict";angular.module("app",["ngRoute","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider",function(e){e.html5Mode(!0),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope",function(e){function n(e){T.setClearColor(A.colors.background,1),x.circles&&(x.circles.material.color.setHex(A.colors.lines),"0"===A.display?x.circles.add():x.circles.remove()),x.lines&&(x.lines.material.color.setHex(A.colors.lines),"1"===A.display?x.lines.add():x.lines.remove()),x.dots&&(x.dots.material.color.setHex(A.colors.lines),"2"===A.display?x.dots.add():x.dots.remove())}function o(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,-40,-40),new THREE.Vector3(0,40,-40),new THREE.Vector3(0,140,-40),new THREE.Vector3(0,40,40),new THREE.Vector3(0,-40,40)]);e.type="catmullrom",e.closed=!0;var n=new THREE.Object3D;w.add(n);var o=new THREE.Vector3,r=new THREE.Vector3,t=new THREE.MeshLambertMaterial({color:16711935}),a=new THREE.MeshBasicMaterial({color:0,opacity:.3,wireframe:!0,transparent:!0}),i=new THREE.TubeBufferGeometry(e,500,2,12,!0),l=THREE.SceneUtils.createMultiMaterialObject(i,[t,a]);return n.add(l),{object:n,geometry:i,normal:o,binormal:r}}function r(e,n,o){var r=A.rows,t=A.audioStrength,a=A.noiseStrength,i=Math.floor(n/r),l=n-i*r,c=2*Math.abs(l-r/2),s=1-Math.abs(i-r/2)/(r/2),d=1-Math.abs(l-r/2)/(r/2),u=(s+d)/2,f=c%A.bands,E=h[f],p=E/A.bands*s*2,m=i*r+(l+o)%r,w=A.noiseMap[m]/64*a*u+t*p;e.z+=(w-e.z)/(3+3*Math.max(1e-6,1-u))}function t(){function e(){console.log("OBJECTS.dots.add"),w.add(i)}function n(){console.log("OBJECTS.dots.remove"),w.remove(i)}function o(){angular.forEach(a.vertices,function(e,n){r(e,n,E)}),E++,a.verticesNeedUpdate=!0}for(var t=new THREE.PointsMaterial({color:A.colors.lines,size:1,sizeAttenuation:!1}),a=new THREE.Geometry,i=new THREE.Points(a,t),l=A.rows,c=A.space,s=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),r=n-o*l;return Math.abs(o-l/2),Math.abs(r-l/2),{x:-c*l/2+c*r,y:-c*l/2+c*o,z:0}}),d=0,u=s.length;d<u;){var f=s[d],h=new THREE.Vector3;h.x=f.x,h.y=f.y,h.z=f.z,a.vertices.push(h),d++}a.verticesNeedUpdate=!0,i.geometry=a;var E=0;return{add:e,remove:n,update:o,object:i,material:t}}function a(){function e(){console.log("OBJECTS.lines.add"),w.add(t)}function n(){console.log("OBJECTS.lines.remove"),w.remove(t)}function o(){A.rows,A.audioStrength,A.noiseStrength,angular.forEach(u,function(e,n){r(e,n,f)}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),f++}var t,a,i=[];a=new THREE.LineBasicMaterial({color:A.colors.lines}),t=new THREE.Object3D;for(var l=A.rows,c=A.space;i.length<A.rows;){var s=new THREE.Geometry,d=new THREE.Line(s,a);d.points=new Array(l).fill(null),i.push(d),t.add(d)}var u=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),r=n-o*l,t=(Math.abs(o-l/2),Math.abs(r-l/2),new THREE.Vector3(-c*l/2+c*r,-c*l/2+c*o,0));return i[r].points[o]=t,i[r].geometry.vertices.push(t),t}),f=0;return{add:e,remove:n,update:o,object:t,material:a}}function i(){function e(){console.log("OBJECTS.circles.add"),w.add(r)}function n(){console.log("OBJECTS.circles.remove"),w.remove(r)}function o(){var e=A.rows,n=A.audioStrength,o=A.noiseStrength,r=A.circularStrength;angular.forEach(s,function(t,a){var i=Math.floor(a/e),l=a-i*e,c=(Math.abs(l-e/2),Math.abs(i-e/2),Math.abs(l-e/2),i%A.bands),s=(h[c]+h[e-1-c])/2,u=s/A.bands,f=l*e+(i+d)%e,E=A.noiseMap[f],p=1-(e-l)/e*r,m=t.r.z+E/64*o*p+2*n*u*u*p,w=t.radius||m;w+=(m-w)/2,t.x=t.r.x*w,t.y=-l,t.z=t.r.y*w,t.radius=w}),angular.forEach(a,function(e,n){e.geometry.verticesNeedUpdate=!0}),d++}var r,t,a=[];t=new THREE.LineBasicMaterial({color:A.colors.lines}),r=new THREE.Object3D;var i=A.rows;for(A.space;a.length<A.rows;){var l=new THREE.Geometry,c=new THREE.LineLoop(l,t);c.points=new Array(i).fill(null),a.push(c),r.add(c)}var s=new Array(i*i).fill(null).map(function(e,n){var o=Math.floor(n/i),r=n-o*i,t=2*Math.PI/i,l=t*o+t*r*.1,c=new THREE.Vector3;return c.r={x:Math.cos(l),y:Math.sin(l),z:96+r*r*r*1e-4},a[r].points[o]=c,a[r].geometry.vertices.push(c),c}),d=0;return{add:e,remove:n,update:o,object:r,material:t}}function l(){h&&(f.getByteFrequencyData(h),"0"===A.display?x.circles.update():"1"===A.display?x.lines.update():"2"===A.display&&x.dots.update())}function c(){p.begin(),s(),p.end(),requestAnimationFrame(c)}function s(){z&&z.update(),l(),T.render(w,g)}function d(){function e(){R=window.innerWidth,C=window.innerHeight,S=R/2,_=C/2,T.setSize(R,C),g.aspect=R/C,g.updateProjectionMatrix()}window.addEventListener("resize",e,!1)}function u(){function e(e){return e*e*e*(e*(6*e-15)+10)}function n(e,n,o){return n+e*(o-n)}function o(e,n,o,r){var t=15&e,a=t<8?n:o,i=t<4?o:12==t||14==t?n:r;return(0==(1&t)?a:-a)+(0==(2&t)?i:-i)}for(var r=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;t<256;t++)r[256+t]=r[t];return{noise:function(t,a,i){var l=Math.floor(t),c=Math.floor(a),s=Math.floor(i),d=255&l,u=255&c,f=255&s;t-=l,a-=c,i-=s;var h=t-1,E=a-1,p=i-1,m=e(t),w=e(a),g=e(i),v=r[d]+u,M=r[v]+f,y=r[v+1]+f,b=r[d+1]+u,T=r[b]+f,H=r[b+1]+f;return n(g,n(w,n(m,o(r[M],t,a,i),o(r[T],h,a,i)),n(m,o(r[y],t,E,i),o(r[H],h,E,i))),n(w,n(m,o(r[M+1],t,a,p),o(r[T+1],h,a,i-1)),n(m,o(r[y+1],t,E,p),o(r[H+1],h,E,p))))}}}var f,h,E,p,m,w,g,v,M,y,b,T,H,R,C,S,_,z=null,x={},A={audioUrl:"audio/rossini-192.mp3",colors:{background:1118481,lines:10066329,notes:4473924},bands:256,rows:128,space:10,audioStrength:60,noiseStrength:25,circularStrength:.9,display:"0",randomize:function(){for(var e=0;e<m.__controllers.length;e++){var n=m.__controllers[e];if(n.__min){var o=n.__min+(n.__max-n.__min)*Math.random();this[n.property]=o,n.updateDisplay()}n.__color&&(n.__color.r=Math.floor(255*Math.random()),n.__color.g=Math.floor(255*Math.random()),n.__color.b=Math.floor(255*Math.random()),n.updateDisplay(),n.setValue(n.__color.hex))}}};A.points=new Array(2*A.bands).fill(null).map(function(){var e=1e3;return new THREE.Vector3(-e+2e3*Math.random(),-e+2e3*Math.random(),-e+2e3*Math.random())}),A.noiseMap=function(e,n){for(var o=e*n,r=new Uint8Array(o),t=new u,a=1,i=100*Math.random(),l=0;l<4;l++){for(var c=0;c<o;c++){var s=c%e,d=~~(c/e);r[c]+=Math.abs(t.noise(s/a,d/a,i)*a*1.75)}a*=5}return r}(A.rows,A.rows),function(){R=window.innerWidth,C=window.innerHeight,M=R/C,S=R/2,_=C/2,v=60,y=1,b=2e4,w=new THREE.Scene,g=new THREE.PerspectiveCamera(v,M,y,b),g.position.z=100,g.position.y=-500,g.lookAt(new THREE.Vector3(0,0,0)),T=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),T.setSize(R,C),T.setClearColor(A.colors.background,1),T.shadowMap.enabled=!0,H=document.getElementById("scene"),H.appendChild(T.domElement),p=new Stats,H.appendChild(p.dom),d()}(),function(){x.dots=t(),x.lines=a(),x.circles=i(),x.path=o()}(),function(){var e,n,o=window.AudioContext||window.webkitAudioContext;e=null,n=new o,f=n.createAnalyser(),E=new Audio,E.src=A.audioUrl,E.controls=!0,E.addEventListener("canplay",function(){var o;return console.log("audio canplay"),e=n.createMediaElementSource(E),e.connect(f),e.connect(n.destination),f.fftSize=2*A.bands,o=f.frequencyBinCount,console.log("bufferLength",o),h=new Uint8Array(o)}),E.play()}(),function(){m=new dat.GUI,m.closed=!0,m.add(A,"display",{Circles:0,Lines:1,Dots:2}).onChange(n),m.addColor(A.colors,"background").onChange(n),m.addColor(A.colors,"lines").onChange(n),m.add(A,"audioStrength",10,100).onChange(n),m.add(A,"noiseStrength",10,100).onChange(n),m.add(A,"circularStrength",.01,.9).onChange(n),m.add(A,"randomize")}(),n(),c()}])}();
//# sourceMappingURL=app.min.js.map
