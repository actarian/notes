!function(){"use strict";angular.module("app",["ngRoute","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(n){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider",function(n){n.html5Mode(!0),n.hashPrefix("")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(n){}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope",function(n){function e(n){b.setClearColor(z.colors.background,1),x.ground&&(x.ground.material.color.setHex(z.colors.lines),z.displayLines?x.ground.remove():x.ground.add()),x.groundLines&&(x.groundLines.material.color.setHex(z.colors.lines),z.displayLines?x.groundLines.add():x.groundLines.remove())}function o(n,e,o){var t=z.rows,r=z.strength,a=z.noiseStrength,i=Math.floor(e/t),s=e-i*t,u=2*Math.abs(s-t/2),d=1-Math.abs(i-t/2)/(t/2),c=1-Math.abs(s-t/2)/(t/2),f=(d+c)/2,g=u%z.bands,h=l[g],p=h/z.bands*d*2,m=i*t+(s+o)%t,w=z.noiseMap[m]/64*a*f+r*p;n.z+=(w-n.z)/(3+3*Math.max(1e-6,1-f))}function t(){function n(){console.log("OBJECTS.ground.add"),p.add(i)}function e(){console.log("OBJECTS.ground.remove"),p.remove(i)}function t(){angular.forEach(a.vertices,function(n,e){o(n,e,h)}),h++,a.verticesNeedUpdate=!0}for(var r=new THREE.PointsMaterial({color:z.colors.lines,size:1,sizeAttenuation:!1}),a=new THREE.Geometry,i=new THREE.Points(a,r),s=z.rows,u=z.space,d=new Array(s*s).fill(null).map(function(n,e){var o=Math.floor(e/s),t=e-o*s;return Math.abs(o-s/2),Math.abs(t-s/2),{x:-u*s/2+u*t,y:-u*s/2+u*o,z:0}}),c=0,l=d.length;c<l;){var f=d[c],g=new THREE.Vector3;g.x=f.x,g.y=f.y,g.z=f.z,a.vertices.push(g),c++}a.verticesNeedUpdate=!0,i.geometry=a;var h=0;return{add:n,remove:e,update:t,object:i,material:r}}function r(){function n(){console.log("OBJECTS.groundLines.add"),p.add(r)}function e(){console.log("OBJECTS.groundLines.remove"),p.remove(r)}function t(){z.rows,z.strength,z.noiseStrength,angular.forEach(l,function(n,e){o(n,e,f)}),angular.forEach(i,function(n,e){n.geometry.verticesNeedUpdate=!0}),f++}var r,a,i=[];a=new THREE.LineBasicMaterial({color:z.colors.lines}),r=new THREE.Object3D;for(var s=z.rows,u=z.space;i.length<z.rows;){var d=new THREE.Geometry,c=new THREE.Line(d,a);c.points=new Array(s).fill(null),i.push(c),r.add(c)}var l=new Array(s*s).fill(null).map(function(n,e){var o=Math.floor(e/s),t=e-o*s,r=(Math.abs(o-s/2),Math.abs(t-s/2),new THREE.Vector3(-u*s/2+u*t,-u*s/2+u*o,0));return i[t].points[o]=r,i[t].geometry.vertices.push(r),r}),f=0;return{add:n,remove:e,update:t,object:r,material:a}}function a(){l&&(c.getByteFrequencyData(l),z.displayLines?x.groundLines.update():x.ground.update())}function i(){g.begin(),s(),g.end(),requestAnimationFrame(i)}function s(){w&&w.update(),a(),b.render(p,m)}function u(){function n(n){S={x:n.clientX,y:n.clientY}}function e(n){}function o(n){}function t(n){n.touches.length>1&&(n.preventDefault(),mousePos={x:n.touches[0].pageX,y:n.touches[0].pageY})}function r(n){mousePos={x:windowHalfX,y:windowHalfY}}function a(n){1==n.touches.length&&(n.preventDefault(),mousePos={x:n.touches[0].pageX,y:n.touches[0].pageY})}function i(){C=window.innerWidth,H=window.innerHeight,T=C/2,R=H/2,b.setSize(C,H),m.aspect=C/H,m.updateProjectionMatrix()}window.addEventListener("resize",i,!1),document.addEventListener("mousemove",n,!1),document.addEventListener("mousedown",e,!1),document.addEventListener("mouseup",o,!1),document.addEventListener("touchstart",t,!1),document.addEventListener("touchend",r,!1),document.addEventListener("touchmove",a,!1)}function d(){function n(n){return n*n*n*(n*(6*n-15)+10)}function e(n,e,o){return e+n*(o-e)}function o(n,e,o,t){var r=15&n,a=r<8?e:o,i=r<4?o:12==r||14==r?e:t;return(0==(1&r)?a:-a)+(0==(2&r)?i:-i)}for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)t[256+r]=t[r];return{noise:function(r,a,i){var s=Math.floor(r),u=Math.floor(a),d=Math.floor(i),c=255&s,l=255&u,f=255&d;r-=s,a-=u,i-=d;var g=r-1,h=a-1,p=i-1,m=n(r),w=n(a),v=n(i),E=t[c]+l,y=t[E]+f,M=t[E+1]+f,b=t[c+1]+l,L=t[b]+f,C=t[b+1]+f;return e(v,e(w,e(m,o(t[y],r,a,i),o(t[L],g,a,i)),e(m,o(t[M],r,h,i),o(t[C],g,h,i))),e(w,e(m,o(t[y+1],r,a,p),o(t[L+1],g,a,i-1)),e(m,o(t[M+1],r,h,p),o(t[C+1],g,h,p))))}}}var c,l,f,g,h,p,m,w,v,E,y,M,b,L,C,H,T,R,x={},S={x:0,y:0},z={audioUrl:"audio/rossini-192.mp3",colors:{background:1118481,lines:10066329,notes:4473924},bands:256,rows:256,space:10,strength:60,noiseStrength:25,displayLines:!0,randomize:function(){for(var n=0;n<h.__controllers.length;n++){var e=h.__controllers[n];if(e.__min){var o=e.__min+(e.__max-e.__min)*Math.random();this[e.property]=o,e.updateDisplay()}}}};z.points=new Array(2*z.bands).fill(null).map(function(){var n=1e3;return new THREE.Vector3(-n+2e3*Math.random(),-n+2e3*Math.random(),-n+2e3*Math.random())}),z.noiseMap=function(n,e){for(var o=n*e,t=new Uint8Array(o),r=new d,a=1,i=100*Math.random(),s=0;s<4;s++){for(var u=0;u<o;u++){var c=u%n,l=~~(u/n);t[u]+=Math.abs(r.noise(c/a,l/a,i)*a*1.75)}a*=5}return t}(z.rows,z.rows),function(){C=window.innerWidth,H=window.innerHeight,E=C/H,T=C/2,R=H/2,v=60,y=1,M=2e4,p=new THREE.Scene,m=new THREE.PerspectiveCamera(v,E,y,M),m.position.z=100,m.position.y=-500,m.lookAt(new THREE.Vector3(0,0,0)),b=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),b.setSize(C,H),b.setClearColor(z.colors.background,1),b.shadowMap.enabled=!0,L=document.getElementById("scene"),L.appendChild(b.domElement),g=new Stats,L.appendChild(g.dom),u(),w=new THREE.OrbitControls(m,b.domElement)}(),function(){x.ground=t(),x.groundLines=r()}(),function(){var n,e,o=window.AudioContext||window.webkitAudioContext;n=null,e=new o,c=e.createAnalyser(),f=new Audio,f.src=z.audioUrl,f.controls=!0,f.addEventListener("canplay",function(){var o;return console.log("audio canplay"),n=e.createMediaElementSource(f),n.connect(c),n.connect(e.destination),c.fftSize=2*z.bands,o=c.frequencyBinCount,console.log("bufferLength",o),l=new Uint8Array(o)}),f.play()}(),function(){h=new dat.GUI,h.closed=!0,h.add(z,"strength",10,100).onChange(e),h.add(z,"noiseStrength",10,100).onChange(e),h.addColor(z.colors,"background").onChange(e),h.addColor(z.colors,"lines").onChange(e),h.add(z,"displayLines").onChange(e),h.add(z,"randomize")}(),e(),i()}])}();
//# sourceMappingURL=app.min.js.map
