!function(){"use strict";angular.module("app",["ngRoute","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider",function(e){e.html5Mode(!0),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope",function(e){function n(e){T.setClearColor(A.colors.background,1),w&&(w.volume=A.audioVolume),d.circles&&(d.circles.material.color.setHex(A.colors.lines),"0"===A.display?d.circles.add():d.circles.remove()),d.lines&&(d.lines.material.color.setHex(A.colors.lines),"1"===A.display?d.lines.add():d.lines.remove()),d.dots&&(d.dots.material.color.setHex(A.colors.lines),"2"===A.display?d.dots.add():d.dots.remove())}function o(e,n,o){var t=A.rows,r=A.audioStrength,a=A.noiseStrength,i=Math.floor(n/t),l=n-i*t,s=2*Math.abs(l-t/2),c=1-Math.abs(i-t/2)/(t/2),u=1-Math.abs(l-t/2)/(t/2),d=(c+u)/2,f=s%A.bands,p=h[f],w=p/A.bands*c*2,m=i*t+(l+o)%t,g=A.noiseMap[m]/64*a*d+r*w;e.z+=(g-e.z)/(3+3*Math.max(1e-6,1-d))}function t(){function e(){console.log("OBJECTS.circles.add"),v.add(a),u.adding=Date.now(),u.removing=!1,u.enabled=!0,u.tween&&u.tween.kill(),u.tween=TweenLite.to(u,u.duration,{pow:1,delay:0,ease:Power2.easeInOut,onComplete:function(){u.adding=!1}})}function n(){console.log("OBJECTS.circles.remove"),u.adding=!1,u.removing=Date.now(),u.tween&&u.tween.kill(),u.tween=TweenLite.to(u,u.duration,{pow:0,delay:0,ease:Power2.easeInOut,onComplete:function(){u.removing=!1,u.enabled=!1,v.remove(a)}})}function o(){var e=A.rows,n=A.audioStrength,o=A.noiseStrength,t=A.circularStrength;angular.forEach(c,function(r,a){var i=Math.floor(a/e),l=a-i*e,s=(Math.abs(l-e/2),Math.abs(i-e/2),Math.abs(l-e/2),i%A.bands),c=(h[s]+h[e-1-s])/2,u=c/A.bands,f=l*e+(i+d)%e,p=A.noiseMap[f],w=1-(e-l)/e*t,m=r.r.z+p/64*o*w+2*n*u*u*w,g=r.radius||m;g+=(m-g)/2,r.x=r.r.x*g,r.y=r.r.y*g,r.z=0,r.radius=g}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),a.scale.x=a.scale.y=a.scale.z=.001+.3*u.pow,a.lookAt(E.position),d++}var t,r,a,i=[];a=new THREE.Object3D,r=new THREE.LineBasicMaterial({color:A.colors.lines});var l=A.rows;for(A.space;i.length<A.rows;){t=new THREE.Geometry;var s=new THREE.LineLoop(t,r);s.points=new Array(l).fill(null),i.push(s),a.add(s)}var c=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l,r=2*Math.PI/l,a=r*o+r*t*.1,s=new THREE.Vector3;return s.r={x:Math.cos(a),y:Math.sin(a),z:96+t*t*t*1e-4},i[t].points[o]=s,i[t].geometry.vertices.push(s),s}),u={pow:0,duration:.35,enabled:!1,adding:!1,removing:!1},d=0;return{add:e,remove:n,update:o,object:a,material:r,state:u}}function r(){function e(){console.log("OBJECTS.dots.add"),v.add(i)}function n(){console.log("OBJECTS.dots.remove"),v.remove(i)}function t(){angular.forEach(a.vertices,function(e,n){o(e,n,h)}),h++,a.verticesNeedUpdate=!0}for(var r=new THREE.PointsMaterial({color:A.colors.lines,size:1,sizeAttenuation:!1}),a=new THREE.Geometry,i=new THREE.Points(a,r),l=A.rows,s=A.space,c=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l;return Math.abs(o-l/2),Math.abs(t-l/2),{x:-s*l/2+s*t,y:-s*l/2+s*o,z:0}}),u=0,d=c.length;u<d;){var f=c[u],p=new THREE.Vector3;p.x=f.x,p.y=f.y,p.z=f.z,a.vertices.push(p),u++}a.verticesNeedUpdate=!0,i.geometry=a;var h=0;return{object:i,material:r,add:e,remove:n,update:t}}function a(){function e(){console.log("OBJECTS.lines.add"),v.add(r)}function n(){console.log("OBJECTS.lines.remove"),v.remove(r)}function t(){A.rows,A.audioStrength,A.noiseStrength,angular.forEach(d,function(e,n){o(e,n,f)}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),f++}var r,a,i=[];a=new THREE.LineBasicMaterial({color:A.colors.lines}),r=new THREE.Object3D;for(var l=A.rows,s=A.space;i.length<A.rows;){var c=new THREE.Geometry,u=new THREE.Line(c,a);u.points=new Array(l).fill(null),i.push(u),r.add(u)}var d=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l,r=(Math.abs(o-l/2),Math.abs(t-l/2),new THREE.Vector3(-s*l/2+s*t,-s*l/2+s*o,0));return i[t].points[o]=r,i[t].geometry.vertices.push(r),r}),f=0;return{add:e,remove:n,update:t,object:r,material:a}}function i(){h&&(p.getByteFrequencyData(h),"0"===A.display?d.circles.update():"1"===A.display?d.lines.update():"2"===A.display&&d.dots.update())}function l(){m.begin(),s(),m.end(),requestAnimationFrame(l)}function s(){z&&z.update(),i(),T.render(v,E)}function c(){function e(){H=window.innerWidth,R=window.innerHeight,_=H/2,x=R/2,T.setSize(H,R),E.aspect=H/R,E.updateProjectionMatrix()}window.addEventListener("resize",e,!1)}function u(){function e(e){return e*e*e*(e*(6*e-15)+10)}function n(e,n,o){return n+e*(o-n)}function o(e,n,o,t){var r=15&e,a=r<8?n:o,i=r<4?o:12==r||14==r?n:t;return(0==(1&r)?a:-a)+(0==(2&r)?i:-i)}for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)t[256+r]=t[r];return{noise:function(r,a,i){var l=Math.floor(r),s=Math.floor(a),c=Math.floor(i),u=255&l,d=255&s,f=255&c;r-=l,a-=s,i-=c;var p=r-1,h=a-1,w=i-1,m=e(r),g=e(a),v=e(i),E=t[u]+d,y=t[E]+f,M=t[E+1]+f,b=t[u+1]+d,C=t[b]+f,T=t[b+1]+f;return n(v,n(g,n(m,o(t[y],r,a,i),o(t[C],p,a,i)),n(m,o(t[M],r,h,i),o(t[T],p,h,i))),n(g,n(m,o(t[y+1],r,a,w),o(t[C+1],p,a,i-1)),n(m,o(t[M+1],r,h,w),o(t[T+1],p,h,w))))}}}var d={};Number.prototype.mod=function(e){return(this%e+e)%e};var f=function(){function e(e,n){a.tween&&(a.tween.kill(),a.tween=null),a.tween=TweenLite.to(a,a.duration,{pow:e,delay:0,ease:Power2.easeInOut,onComplete:function(){n&&n()}})}function n(n){var o=a.current||0;a.current=n;var r=d.circles[n]||t(n);r.add(),d.circles[n]=r,e(n/i.length,function(){a.tween=null}),setTimeout(function(){if(o!==a.current){var e=d.circles[o];e&&e.remove()}},1e3*a.duration)}function o(){l++,l=Math.min(i.length-1,l),n(l)}function r(){l--,l=Math.max(0,l),n(l)}var a={pow:0,duration:1.5},i=new Array(24).fill().map(function(e,n){return n+1}),l=0;return angular.extend(a,{steps:i,current:l,next:o,previous:r})}();e.stepper=f;var p,h,w,m,g,v,E,y,M,b,C,T,S,H,R,_,x,z=null,A={audioUrl:"audio/rossini-192.mp3",audioVolume:.5,colors:{background:1118481,lines:10066329,notes:4473924},bands:256,rows:128,space:10,audioStrength:60,noiseStrength:25,circularStrength:.9,display:"0",randomize:function(){for(var e=0;e<g.__controllers.length;e++){var n=g.__controllers[e];if(n.__min){var o=n.__min+(n.__max-n.__min)*Math.random();this[n.property]=o,n.updateDisplay()}n.__color&&(n.__color.r=Math.floor(255*Math.random()),n.__color.g=Math.floor(255*Math.random()),n.__color.b=Math.floor(255*Math.random()),n.updateDisplay(),n.setValue(n.__color.hex))}}};A.points=new Array(2*A.bands).fill(null).map(function(){var e=1e3;return new THREE.Vector3(-e+2e3*Math.random(),-e+2e3*Math.random(),-e+2e3*Math.random())}),A.noiseMap=function(e,n){for(var o=e*n,t=new Uint8Array(o),r=new u,a=1,i=100*Math.random(),l=0;l<4;l++){for(var s=0;s<o;s++){var c=s%e,d=~~(s/e);t[s]+=Math.abs(r.noise(c/a,d/a,i)*a*1.75)}a*=5}return t}(A.rows,A.rows),function(){H=window.innerWidth,R=window.innerHeight,M=H/R,_=H/2,x=R/2,y=60,b=.001,C=2e4,v=new THREE.Scene,E=new THREE.PerspectiveCamera(y,M,b,C),E.position.z=100,E.position.y=-500,E.lookAt(new THREE.Vector3(0,0,0)),T=new THREE.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0}),T.setClearColor(0,0),T.setSize(H,R),T.shadowMap.enabled=!0,S=document.getElementById("scene"),S.appendChild(T.domElement),m=new Stats,S.appendChild(m.dom),c()}(),function(){d.dots=r(),d.lines=a(),d.circles=t()}(),function(){var e,n,o=window.AudioContext||window.webkitAudioContext;e=null,n=new o,p=n.createAnalyser(),w=new Audio,w.src=A.audioUrl,w.controls=!0,w.addEventListener("canplay",function(){var o;return console.log("audio canplay"),e=n.createMediaElementSource(w),e.connect(p),e.connect(n.destination),p.fftSize=2*A.bands,o=p.frequencyBinCount,console.log("bufferLength",o),h=new Uint8Array(o)}),w.volume=A.audioVolume,w.play()}(),function(){g=new dat.GUI,g.closed=!0,g.add(A,"display",{Circles:0,Lines:1,Dots:2}).onChange(n),g.addColor(A.colors,"background").onChange(n),g.addColor(A.colors,"lines").onChange(n),g.add(A,"audioVolume",.01,1).onChange(n),g.add(A,"audioStrength",10,100).onChange(n),g.add(A,"noiseStrength",10,100).onChange(n),g.add(A,"circularStrength",.01,.9).onChange(n),g.add(A,"randomize")}(),n(),l()}])}();
//# sourceMappingURL=app.min.js.map
