!function(){"use strict";angular.module("app",["ngRoute","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider",function(e){e.html5Mode(!0),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope",function(e){function n(e){C.setClearColor(L.colors.background,1),z.circles&&(z.circles.material.color.setHex(L.colors.lines),"0"===L.display?z.circles.add():z.circles.remove()),z.lines&&(z.lines.material.color.setHex(L.colors.lines),"1"===L.display?z.lines.add():z.lines.remove()),z.dots&&(z.dots.material.color.setHex(L.colors.lines),"2"===L.display?z.dots.add():z.dots.remove())}function o(e,n,o){var t=L.rows,r=L.audioStrength,a=L.noiseStrength,i=Math.floor(n/t),s=n-i*t,c=2*Math.abs(s-t/2),l=1-Math.abs(i-t/2)/(t/2),d=1-Math.abs(s-t/2)/(t/2),u=(l+d)/2,h=c%L.bands,p=f[h],m=p/L.bands*l*2,g=i*t+(s+o)%t,v=L.noiseMap[g]/64*a*u+r*m;e.z+=(v-e.z)/(3+3*Math.max(1e-6,1-u))}function t(){function e(){console.log("OBJECTS.dots.add"),g.add(i)}function n(){console.log("OBJECTS.dots.remove"),g.remove(i)}function t(){angular.forEach(a.vertices,function(e,n){o(e,n,p)}),p++,a.verticesNeedUpdate=!0}for(var r=new THREE.PointsMaterial({color:L.colors.lines,size:1,sizeAttenuation:!1}),a=new THREE.Geometry,i=new THREE.Points(a,r),s=L.rows,c=L.space,l=new Array(s*s).fill(null).map(function(e,n){var o=Math.floor(n/s),t=n-o*s;return Math.abs(o-s/2),Math.abs(t-s/2),{x:-c*s/2+c*t,y:-c*s/2+c*o,z:0}}),d=0,u=l.length;d<u;){var f=l[d],h=new THREE.Vector3;h.x=f.x,h.y=f.y,h.z=f.z,a.vertices.push(h),d++}a.verticesNeedUpdate=!0,i.geometry=a;var p=0;return{add:e,remove:n,update:t,object:i,material:r}}function r(){function e(){console.log("OBJECTS.lines.add"),g.add(r)}function n(){console.log("OBJECTS.lines.remove"),g.remove(r)}function t(){L.rows,L.audioStrength,L.noiseStrength,angular.forEach(u,function(e,n){o(e,n,f)}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),f++}var r,a,i=[];a=new THREE.LineBasicMaterial({color:L.colors.lines}),r=new THREE.Object3D;for(var s=L.rows,c=L.space;i.length<L.rows;){var l=new THREE.Geometry,d=new THREE.Line(l,a);d.points=new Array(s).fill(null),i.push(d),r.add(d)}var u=new Array(s*s).fill(null).map(function(e,n){var o=Math.floor(n/s),t=n-o*s,r=(Math.abs(o-s/2),Math.abs(t-s/2),new THREE.Vector3(-c*s/2+c*t,-c*s/2+c*o,0));return i[t].points[o]=r,i[t].geometry.vertices.push(r),r}),f=0;return{add:e,remove:n,update:t,object:r,material:a}}function a(){function e(){console.log("OBJECTS.circles.add"),g.add(t)}function n(){console.log("OBJECTS.circles.remove"),g.remove(t)}function o(){var e=L.rows,n=L.audioStrength,o=L.noiseStrength,t=L.circularStrength;angular.forEach(l,function(r,a){var i=Math.floor(a/e),s=a-i*e,c=(Math.abs(s-e/2),Math.abs(i-e/2),Math.abs(s-e/2),i%L.bands),l=(f[c]+f[e-1-c])/2,u=l/L.bands,h=s*e+(i+d)%e,p=L.noiseMap[h],m=1-(e-s)/e*t,g=r.r.z+p/64*o*m+2*n*u*u*m,v=r.radius||g;v+=(g-v)/2,r.x=r.r.x*v,r.y=-s,r.z=r.r.y*v,r.radius=v}),angular.forEach(a,function(e,n){e.geometry.verticesNeedUpdate=!0}),d++}var t,r,a=[];r=new THREE.LineBasicMaterial({color:L.colors.lines}),t=new THREE.Object3D;var i=L.rows;for(L.space;a.length<L.rows;){var s=new THREE.Geometry,c=new THREE.LineLoop(s,r);c.points=new Array(i).fill(null),a.push(c),t.add(c)}var l=new Array(i*i).fill(null).map(function(e,n){var o=Math.floor(n/i),t=n-o*i,r=2*Math.PI/i,s=r*o+r*t*.1,c=new THREE.Vector3;return c.r={x:Math.cos(s),y:Math.sin(s),z:96+t*t*t*1e-4},a[t].points[o]=c,a[t].geometry.vertices.push(c),c}),d=0;return{add:e,remove:n,update:o,object:t,material:r}}function i(){f&&(u.getByteFrequencyData(f),"0"===L.display?z.circles.update():"1"===L.display?z.lines.update():"2"===L.display&&z.dots.update())}function s(){p.begin(),c(),p.end(),requestAnimationFrame(s)}function c(){w&&w.update(),i(),C.render(g,v)}function l(){function e(e){x={x:e.clientX,y:e.clientY}}function n(e){}function o(e){}function t(e){e.touches.length>1&&(e.preventDefault(),mousePos={x:e.touches[0].pageX,y:e.touches[0].pageY})}function r(e){mousePos={x:windowHalfX,y:windowHalfY}}function a(e){1==e.touches.length&&(e.preventDefault(),mousePos={x:e.touches[0].pageX,y:e.touches[0].pageY})}function i(){S=window.innerWidth,T=window.innerHeight,R=S/2,_=T/2,C.setSize(S,T),v.aspect=S/T,v.updateProjectionMatrix()}window.addEventListener("resize",i,!1),document.addEventListener("mousemove",e,!1),document.addEventListener("mousedown",n,!1),document.addEventListener("mouseup",o,!1),document.addEventListener("touchstart",t,!1),document.addEventListener("touchend",r,!1),document.addEventListener("touchmove",a,!1)}function d(){function e(e){return e*e*e*(e*(6*e-15)+10)}function n(e,n,o){return n+e*(o-n)}function o(e,n,o,t){var r=15&e,a=r<8?n:o,i=r<4?o:12==r||14==r?n:t;return(0==(1&r)?a:-a)+(0==(2&r)?i:-i)}for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)t[256+r]=t[r];return{noise:function(r,a,i){var s=Math.floor(r),c=Math.floor(a),l=Math.floor(i),d=255&s,u=255&c,f=255&l;r-=s,a-=c,i-=l;var h=r-1,p=a-1,m=i-1,g=e(r),v=e(a),w=e(i),E=t[d]+u,y=t[E]+f,M=t[E+1]+f,b=t[d+1]+u,C=t[b]+f,H=t[b+1]+f;return n(w,n(v,n(g,o(t[y],r,a,i),o(t[C],h,a,i)),n(g,o(t[M],r,p,i),o(t[H],h,p,i))),n(v,n(g,o(t[y+1],r,a,m),o(t[C+1],h,a,i-1)),n(g,o(t[M+1],r,p,m),o(t[H+1],h,p,m))))}}}var u,f,h,p,m,g,v,w,E,y,M,b,C,H,S,T,R,_,x={x:0,y:0},z={},L={audioUrl:"audio/rossini-192.mp3",colors:{background:1118481,lines:10066329,notes:4473924},bands:256,rows:128,space:10,audioStrength:60,noiseStrength:25,circularStrength:.9,display:"0",randomize:function(){for(var e=0;e<m.__controllers.length;e++){var n=m.__controllers[e];if(n.__min){var o=n.__min+(n.__max-n.__min)*Math.random();this[n.property]=o,n.updateDisplay()}n.__color&&(n.__color.r=Math.floor(255*Math.random()),n.__color.g=Math.floor(255*Math.random()),n.__color.b=Math.floor(255*Math.random()),n.updateDisplay(),n.setValue(n.__color.hex))}}};L.points=new Array(2*L.bands).fill(null).map(function(){var e=1e3;return new THREE.Vector3(-e+2e3*Math.random(),-e+2e3*Math.random(),-e+2e3*Math.random())}),L.noiseMap=function(e,n){for(var o=e*n,t=new Uint8Array(o),r=new d,a=1,i=100*Math.random(),s=0;s<4;s++){for(var c=0;c<o;c++){var l=c%e,u=~~(c/e);t[c]+=Math.abs(r.noise(l/a,u/a,i)*a*1.75)}a*=5}return t}(L.rows,L.rows),function(){S=window.innerWidth,T=window.innerHeight,y=S/T,R=S/2,_=T/2,E=60,M=1,b=2e4,g=new THREE.Scene,v=new THREE.PerspectiveCamera(E,y,M,b),v.position.z=100,v.position.y=-500,v.lookAt(new THREE.Vector3(0,0,0)),C=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),C.setSize(S,T),C.setClearColor(L.colors.background,1),C.shadowMap.enabled=!0,H=document.getElementById("scene"),H.appendChild(C.domElement),p=new Stats,H.appendChild(p.dom),l(),w=new THREE.OrbitControls(v,C.domElement)}(),function(){z.dots=t(),z.lines=r(),z.circles=a()}(),function(){var e,n,o=window.AudioContext||window.webkitAudioContext;e=null,n=new o,u=n.createAnalyser(),h=new Audio,h.src=L.audioUrl,h.controls=!0,h.addEventListener("canplay",function(){var o;return console.log("audio canplay"),e=n.createMediaElementSource(h),e.connect(u),e.connect(n.destination),u.fftSize=2*L.bands,o=u.frequencyBinCount,console.log("bufferLength",o),f=new Uint8Array(o)}),h.play()}(),function(){m=new dat.GUI,m.closed=!0,m.add(L,"display",{Circles:0,Lines:1,Dots:2}).onChange(n),m.addColor(L.colors,"background").onChange(n),m.addColor(L.colors,"lines").onChange(n),m.add(L,"audioStrength",10,100).onChange(n),m.add(L,"noiseStrength",10,100).onChange(n),m.add(L,"circularStrength",.01,.9).onChange(n),m.add(L,"randomize")}(),n(),s()}])}();
//# sourceMappingURL=app.min.js.map
