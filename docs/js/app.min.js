!function(){"use strict";angular.module("app",["ngRoute","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider",function(e){e.html5Mode(!0),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope","AudioSound",function(e,n){function o(e){A.setClearColor(V.colors.background,1),w&&(w.volume=V.audioVolume),p.circles&&(p.circles.material.color.setHex(V.colors.lines),"0"===V.display?p.circles.add():p.circles.remove()),p.lines&&(p.lines.material.color.setHex(V.colors.lines),"1"===V.display?p.lines.add():p.lines.remove()),p.dots&&(p.dots.material.color.setHex(V.colors.lines),"2"===V.display?p.dots.add():p.dots.remove())}function t(e,n,o){var t=V.rows,r=V.audioStrength,a=V.noiseStrength,i=Math.floor(n/t),l=n-i*t,s=2*Math.abs(l-t/2),u=1-Math.abs(i-t/2)/(t/2),c=1-Math.abs(l-t/2)/(t/2),d=(u+c)/2,p=s%V.bands,h=f.data[p],m=h/V.bands*u*2,v=i*t+(l+o)%t,w=V.noiseMap[v]/64*a*d+r*m;e.z+=(w-e.z)/(3+3*Math.max(1e-6,1-d))}function r(){function e(){console.log("OBJECTS.circles.add"),E.add(a),c.adding=Date.now(),c.removing=!1,c.enabled=!0,c.tween&&c.tween.kill(),c.tween=TweenLite.to(c,c.duration,{pow:1,delay:0,ease:Power2.easeInOut,onComplete:function(){c.adding=!1}})}function n(){console.log("OBJECTS.circles.remove"),c.adding=!1,c.removing=Date.now(),c.tween&&c.tween.kill(),c.tween=TweenLite.to(c,c.duration,{pow:0,delay:0,ease:Power2.easeInOut,onComplete:function(){c.removing=!1,c.enabled=!1,E.remove(a)}})}function o(){var e=V.rows,n=V.audioStrength,o=V.noiseStrength,t=V.circularStrength;angular.forEach(u,function(r,a){var i=Math.floor(a/e),l=a-i*e,s=(Math.abs(l-e/2),Math.abs(i-e/2),Math.abs(l-e/2),i%V.bands),u=(f.data[s]+f.data[e-1-s])/2,c=u/V.bands,p=l*e+(i+d)%e,h=V.noiseMap[p],m=1-(e-l)/e*t,v=r.r.z+h/64*o*m+2*n*c*c*m,w=r.radius||v;w+=(v-w)/2,r.x=r.r.x*w,r.y=r.r.y*w,r.z=0,r.radius=w}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),a.scale.x=a.scale.y=a.scale.z=.001+.3*c.pow,a.lookAt(M.position),d++}var t,r,a,i=[];a=new THREE.Object3D,r=new THREE.LineBasicMaterial({color:V.colors.lines});var l=V.rows;for(V.space;i.length<V.rows;){t=new THREE.Geometry;var s=new THREE.LineLoop(t,r);s.points=new Array(l).fill(null),i.push(s),a.add(s)}var u=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l,r=2*Math.PI/l,a=r*o+r*t*.1,s=new THREE.Vector3;return s.r={x:Math.cos(a),y:Math.sin(a),z:96+t*t*t*1e-4},i[t].points[o]=s,i[t].geometry.vertices.push(s),s}),c={pow:0,duration:.35,enabled:!1,adding:!1,removing:!1},d=0;return{add:e,remove:n,update:o,object:a,material:r,state:c}}function a(){function e(){console.log("OBJECTS.dots.add"),E.add(i)}function n(){console.log("OBJECTS.dots.remove"),E.remove(i)}function o(){angular.forEach(a.vertices,function(e,n){t(e,n,h)}),h++,a.verticesNeedUpdate=!0}for(var r=new THREE.PointsMaterial({color:V.colors.lines,size:1,sizeAttenuation:!1}),a=new THREE.Geometry,i=new THREE.Points(a,r),l=V.rows,s=V.space,u=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l;return Math.abs(o-l/2),Math.abs(t-l/2),{x:-s*l/2+s*t,y:-s*l/2+s*o,z:0}}),c=0,d=u.length;c<d;){var f=u[c],p=new THREE.Vector3;p.x=f.x,p.y=f.y,p.z=f.z,a.vertices.push(p),c++}a.verticesNeedUpdate=!0,i.geometry=a;var h=0;return{object:i,material:r,add:e,remove:n,update:o}}function i(){function e(){console.log("OBJECTS.lines.add"),E.add(r)}function n(){console.log("OBJECTS.lines.remove"),E.remove(r)}function o(){V.rows,V.audioStrength,V.noiseStrength,angular.forEach(d,function(e,n){t(e,n,f)}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),f++}var r,a,i=[];a=new THREE.LineBasicMaterial({color:V.colors.lines}),r=new THREE.Object3D;for(var l=V.rows,s=V.space;i.length<V.rows;){var u=new THREE.Geometry,c=new THREE.Line(u,a);c.points=new Array(l).fill(null),i.push(c),r.add(c)}var d=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l,r=(Math.abs(o-l/2),Math.abs(t-l/2),new THREE.Vector3(-s*l/2+s*t,-s*l/2+s*o,0));return i[t].points[o]=r,i[t].geometry.vertices.push(r),r}),f=0;return{add:e,remove:n,update:o,object:r,material:a}}function l(){v&&m.getByteFrequencyData(v),"0"===V.display?p.circles&&p.circles.update():"1"===V.display?p.lines&&p.lines.update():"2"===V.display&&p.dots&&p.dots.update()}function s(){g.begin(),u(),g.end(),requestAnimationFrame(s)}function u(){B&&B.update(),f.update(),l(),A.render(E,M)}function c(){function e(){R=window.innerWidth,x=window.innerHeight,_=R/2,z=x/2,A.setSize(R,x),M.aspect=R/x,M.updateProjectionMatrix()}window.addEventListener("resize",e,!1)}function d(){function e(e){return e*e*e*(e*(6*e-15)+10)}function n(e,n,o){return n+e*(o-n)}function o(e,n,o,t){var r=15&e,a=r<8?n:o,i=r<4?o:12==r||14==r?n:t;return(0==(1&r)?a:-a)+(0==(2&r)?i:-i)}for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)t[256+r]=t[r];return{noise:function(r,a,i){var l=Math.floor(r),s=Math.floor(a),u=Math.floor(i),c=255&l,d=255&s,f=255&u;r-=l,a-=s,i-=u;var p=r-1,h=a-1,m=i-1,v=e(r),w=e(a),g=e(i),y=t[c]+d,E=t[y]+f,M=t[y+1]+f,b=t[c+1]+d,S=t[b]+f,T=t[b+1]+f;return n(g,n(w,n(v,o(t[E],r,a,i),o(t[S],p,a,i)),n(v,o(t[M],r,h,i),o(t[T],p,h,i))),n(w,n(v,o(t[E+1],r,a,m),o(t[S+1],p,a,i-1)),n(v,o(t[M+1],r,h,m),o(t[T+1],p,h,m))))}}}var f=new n("audio/07-rossini-192.mp3",{loop:!0,analyser:!0}),p={};Number.prototype.mod=function(e){return(this%e+e)%e};var h=function(){function e(e,n){a.tween&&(a.tween.kill(),a.tween=null),a.tween=TweenLite.to(a,a.duration,{pow:e,delay:0,ease:Power2.easeInOut,onComplete:function(){n&&n()}})}function n(n){var o=a.current||0;a.current=n;var t=p.circles[n]||r(n);t.add(),p.circles[n]=t,e(n/i.length,function(){a.tween=null}),setTimeout(function(){if(o!==a.current){var e=p.circles[o];e&&e.remove()}},1e3*a.duration)}function o(){l++,l=Math.min(i.length-1,l),n(l)}function t(){l--,l=Math.max(0,l),n(l)}var a={pow:0,duration:1.5},i=new Array(24).fill().map(function(e,n){return n+1}),l=0;return angular.extend(a,{steps:i,current:l,next:o,previous:t})}();e.stepper=h;var m,v,w,g,y,E,M,b,S,T,C,A,H,R,x,_,z,B=null,V={audioUrl:"audio/rossini-192.mp3",audioVolume:.5,colors:{background:1118481,lines:10066329,notes:4473924},bands:256,rows:128,space:10,audioStrength:60,noiseStrength:25,circularStrength:.9,display:"0",randomize:function(){for(var e=0;e<y.__controllers.length;e++){var n=y.__controllers[e];if(n.__min){var o=n.__min+(n.__max-n.__min)*Math.random();this[n.property]=o,n.updateDisplay()}n.__color&&(n.__color.r=Math.floor(255*Math.random()),n.__color.g=Math.floor(255*Math.random()),n.__color.b=Math.floor(255*Math.random()),n.updateDisplay(),n.setValue(n.__color.hex))}}};V.points=new Array(2*V.bands).fill(null).map(function(){var e=1e3;return new THREE.Vector3(-e+2e3*Math.random(),-e+2e3*Math.random(),-e+2e3*Math.random())}),V.noiseMap=function(e,n){for(var o=e*n,t=new Uint8Array(o),r=new d,a=1,i=100*Math.random(),l=0;l<4;l++){for(var s=0;s<o;s++){var u=s%e,c=~~(s/e);t[s]+=Math.abs(r.noise(u/a,c/a,i)*a*1.75)}a*=5}return t}(V.rows,V.rows),function(){R=window.innerWidth,x=window.innerHeight,S=R/x,_=R/2,z=x/2,b=60,T=.001,C=2e4,E=new THREE.Scene,M=new THREE.PerspectiveCamera(b,S,T,C),M.position.z=100,M.position.y=-500,M.lookAt(new THREE.Vector3(0,0,0)),A=new THREE.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0}),A.setClearColor(0,0),A.setSize(R,x),A.shadowMap.enabled=!0,H=document.getElementById("scene"),H.appendChild(A.domElement),g=new Stats,H.appendChild(g.dom),c()}(),function(){p.dots=a(),p.lines=i(),p.circles=r()}(),function(){y=new dat.GUI,y.closed=!0,y.add(V,"display",{Circles:0,Lines:1,Dots:2}).onChange(o),y.addColor(V.colors,"background").onChange(o),y.addColor(V.colors,"lines").onChange(o),y.add(V,"audioVolume",.01,1).onChange(o),y.add(V,"audioStrength",10,100).onChange(o),y.add(V,"noiseStrength",10,100).onChange(o),y.add(V,"circularStrength",.01,.9).onChange(o),y.add(V,"randomize")}(),o(),s(),f.play()}])}(),function(){"use strict";angular.module("app").factory("AudioSound",["$q",function(e){function n(e,n){var o={volume:85,loop:!1};n&&angular.extend(o,n);var r=this;if(r.path=e,r.options=o,r.setVolume(o.volume),r.options.analyser){var a=t.createAnalyser();a.fftSize=512,r.data=new Uint8Array(a.frequencyBinCount),r.analyser=a}}var o=window.AudioContext||window.webkitAudioContext,t=new o,r={};return n.translateVolume=function(e,n){return n?100*e:e/100},n.load=function(n){var o=e.defer(),a=n.path,i=new XMLHttpRequest;return i.responseType="arraybuffer",i.open("GET",a,!0),i.onload=function(){t.decodeAudioData(i.response,function(e){if(!e)return console.log("AudioSound.load.decodeAudioData.error",a),void o.reject("AudioSound.load.decodeAudioData.error");console.log("AudioSound.decodeAudioData",a),r[a]=e,o.resolve(e)})},i.onerror=function(e){console.log("AudioManager.xhr.onerror",e),o.reject(e)},i.send(),o.promise},n.prototype={getBuffer:function(){var o=e.defer(),t=this.path,a=r[t];return a?o.resolve(a):n.load(this).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getSource:function(){var n=e.defer(),o=this.source;if(o)n.resolve(o);else{var r=this;this.getBuffer().then(function(e){var o=t.createBufferSource(),a=t.createGain?t.createGain():t.createGainNode();a.gain.value=r.volume,o.buffer=e,o.connect(a),r.analyser&&o.connect(r.analyser),a.connect(t.destination),n.resolve(o)},function(e){n.reject(e)})}return n.promise},play:function(){var e=this.options;this.getSource().then(function(n){n.loop=e.loop,n.start?n.start(0):n.noteOn(0)}),console.log("AudioSound.play")},stop:function(){this.getSource().then(function(e){e.stop?e.stop(0):e.noteOff(0)}),console.log("AudioSound.stop")},getVolume:function(){return n.translateVolume(this.volume,!0)},setVolume:function(e){this.volume=n.translateVolume(e)},update:function(){var e=this;e.analyser&&e.analyser.getByteFrequencyData(e.data)}},n}])}();
//# sourceMappingURL=app.min.js.map
